"use strict";!function(){const rows=10,cols=10,squareSize=50,gameBoard=[],gameBoardContainer=document.getElementById("gameboard"),strtOvrBtn=document.getElementById("strtOvrBtn"),ships=[],probabilityChart=[];strtOvrBtn.addEventListener("click",(function(){location.reload()}));const randomIntFromInterval=(min,max)=>Math.floor(Math.random()*(max-min+1)+min);let nameIndex=0;const names=["Carrier","Battleship","Cruiser","Submarine","Destroyer"];function placeShip(len){const ship=[],name=names[nameIndex],dir=randomIntFromInterval(1,2),row=randomIntFromInterval(0,9),col=randomIntFromInterval(0,9);let shipPlaceCounter=0;if(1==dir)if(col>=len-1){for(let i=0;i<len;i++)0==gameBoard[row][col-i]&&shipPlaceCounter++;if(shipPlaceCounter==len)for(let i=0;i<len;i++)gameBoard[row][col-i]=1,document.getElementById("s"+row+(col-i)).classList.add(name),ship.push([row,col-i]);else placeShip(len)}else{for(let i=0;i<len;i++)0==gameBoard[row][col+i]&&shipPlaceCounter++;if(shipPlaceCounter==len)for(let i=0;i<len;i++)gameBoard[row][col+i]=1,document.getElementById("s"+row+(col+i)).classList.add(name),ship.push([row,col+i]);else placeShip(len)}else if(row>=len-1){for(let i=0;i<len;i++)0==gameBoard[row-i][col]&&shipPlaceCounter++;if(shipPlaceCounter==len)for(let i=0;i<len;i++)gameBoard[row-i][col]=1,document.getElementById("s"+(row-i)+col).classList.add(name),ship.push([row-i,col]);else placeShip(len)}else{for(let i=0;i<len;i++)0==gameBoard[row+i][col]&&shipPlaceCounter++;if(shipPlaceCounter==len)for(let i=0;i<len;i++)gameBoard[row+i][col]=1,document.getElementById("s"+(row+i)+col).classList.add(name),ship.push([row+i,col]);else placeShip(len)}0!=ship.length&&(ships.push(ship),nameIndex++)}for(let i=0;i<10;i++){gameBoard.push([]);for(let j=0;j<10;j++){gameBoard[i].push(0);const square=document.createElement("div"),num=document.createElement("p");gameBoardContainer.appendChild(square),square.appendChild(num),square.id="s"+j+i,num.id="p"+j+i,num.classList.add("numText");const topPosition=50*j,leftPosition=50*i;square.style.top=topPosition+"px",square.style.left=leftPosition+"px"}}placeShip(5),placeShip(4),placeShip(3),placeShip(3),placeShip(2);for(let i=0;i<10;i++){probabilityChart.push([]);for(let j=0;j<10;j++)probabilityChart[i].push(0),document.getElementById("s"+i+j).style.background="#80aaff",1==gameBoard[i][j]&&(document.getElementById("s"+i+j).style.background="white")}let shipFound=0,carrierSunk=!1,battleshipSunk=!1,cruiserSunk=!1,submarineSunk=!1,destroyerSunk=!1,shotsFired=0,lastShotX,lastShotY,shipDirection="",firstTimeIn=!0,scanCounter=0,tempShipFound=0,gameOver=!1;const shipSunkHelper=function(i,sunkShipName){sunkColorChange(sunkShipName),shipFound-=i,shipDirection="",firstTimeIn=!0,tempShipFound=0,shipHitButNotSunkReassign()},shipSunkChecker=function(){let carrierCounter=0,battleshipCounter=0,cruiserCounter=0,submarineCounter=0,destroyerCounter=0;for(let i=0;i<10;i++)for(let j=0;j<10;j++)document.getElementById("s"+i+j).classList.contains("Carrier")&&document.getElementById("s"+i+j).classList.contains("hit")&&!carrierSunk&&carrierCounter++,document.getElementById("s"+i+j).classList.contains("Battleship")&&document.getElementById("s"+i+j).classList.contains("hit")&&!battleshipSunk&&battleshipCounter++,document.getElementById("s"+i+j).classList.contains("Cruiser")&&document.getElementById("s"+i+j).classList.contains("hit")&&!cruiserSunk&&cruiserCounter++,document.getElementById("s"+i+j).classList.contains("Submarine")&&document.getElementById("s"+i+j).classList.contains("hit")&&!submarineSunk&&submarineCounter++,document.getElementById("s"+i+j).classList.contains("Destroyer")&&document.getElementById("s"+i+j).classList.contains("hit")&&!destroyerSunk&&destroyerCounter++;5==carrierCounter&&(carrierSunk=!0,shipSunkHelper(5,"Carrier")),4==battleshipCounter&&(battleshipSunk=!0,shipSunkHelper(4,"Battleship")),3==cruiserCounter&&(cruiserSunk=!0,shipSunkHelper(3,"Cruiser")),3==submarineCounter&&(submarineSunk=!0,shipSunkHelper(3,"Submarine")),2==destroyerCounter&&(destroyerSunk=!0,shipSunkHelper(2,"Destroyer"))};function gaveOverChecker(){carrierSunk&&battleshipSunk&&cruiserSunk&&submarineSunk&&destroyerSunk&&(gameOver=!0,document.getElementById("totalShots").innerText=shotsFired,document.getElementById("totalHits").innerText=17,document.getElementById("totalMisses").innerText=shotsFired-17,document.getElementById("hitPercentage").innerText=Math.round(17/shotsFired*100)+"%")}const shipFoundAttack=function(){const x=lastShotX,y=lastShotY;if("ver"==shipDirection){if(!(x+1>9)){if(0==gameBoard[x+1][y])return document.getElementById("s"+(x+1)+y).style.background="#4d88ff",document.getElementById("s"+(x+1)+y).classList.add("miss"),gameBoard[x+1][y]=3,shotsFired++,void(document.getElementById("p"+(x+1)+y).innerText=shotsFired);if(1==gameBoard[x+1][y])return document.getElementById("s"+(x+1)+y).style.background="red",document.getElementById("s"+(x+1)+y).classList.add("hit"),gameBoard[x+1][y]=2,shotsFired++,shipFound++,lastShotX++,void(document.getElementById("p"+(x+1)+y).innerText=shotsFired)}if(x+1>9||2==gameBoard[x+1][y]||3==gameBoard[x+1][y]){if(firstTimeIn&&(tempShipFound=shipFound+tempShipFound,firstTimeIn=!1),x-tempShipFound>-1&&0==gameBoard[x-tempShipFound][y])return document.getElementById("s"+(x-tempShipFound)+y).style.background="#4d88ff",document.getElementById("s"+(x-tempShipFound)+y).classList.add("miss"),gameBoard[x-tempShipFound][y]=3,shotsFired++,void(document.getElementById("p"+(x-tempShipFound)+y).innerText=shotsFired);if(x-tempShipFound>-1&&1==gameBoard[x-tempShipFound][y])return document.getElementById("s"+(x-tempShipFound)+y).style.background="red",document.getElementById("s"+(x-tempShipFound)+y).classList.add("hit"),gameBoard[x-tempShipFound][y]=2,shotsFired++,shipFound++,lastShotX--,void(document.getElementById("p"+(x-tempShipFound)+y).innerText=shotsFired);scanCounter=0,shipDirection="",firstTimeIn=!0,tempShipFound--,tempShipFound--}}if("hor"==shipDirection){if(!(y+1>9)){if(0==gameBoard[x][y+1])return document.getElementById("s"+x+(y+1)).style.background="#4d88ff",document.getElementById("s"+x+(y+1)).classList.add("miss"),gameBoard[x][y+1]=3,shotsFired++,void(document.getElementById("p"+x+(y+1)).innerText=shotsFired);if(1==gameBoard[x][y+1])return document.getElementById("s"+x+(y+1)).style.background="red",document.getElementById("s"+x+(y+1)).classList.add("hit"),gameBoard[x][y+1]=2,shotsFired++,shipFound++,lastShotY++,void(document.getElementById("p"+x+(y+1)).innerText=shotsFired)}if(y+1>9||2==gameBoard[x][y+1]||3==gameBoard[x][y+1]){if(firstTimeIn&&(tempShipFound=shipFound+tempShipFound,firstTimeIn=!1),0==gameBoard[x][y-tempShipFound])return document.getElementById("s"+x+(y-tempShipFound)).style.background="#4d88ff",document.getElementById("s"+x+(y-tempShipFound)).classList.add("miss"),gameBoard[x][y-tempShipFound]=3,shotsFired++,void(document.getElementById("p"+x+(y-tempShipFound)).innerText=shotsFired);for(let i=1;i<10&&!(y-i<0);i++)if(1==gameBoard[x][y-i])return document.getElementById("s"+x+(y-i)).style.background="red",document.getElementById("s"+x+(y-i)).classList.add("hit"),gameBoard[x][y-i]=2,shotsFired++,shipFound++,void(document.getElementById("p"+x+(y-i)).innerText=shotsFired);scanCounter=0,shipDirection="",firstTimeIn=!0,tempShipFound--,tempShipFound--}}if(0==scanCounter&&""==shipDirection)if(x+1>9)scanCounter++;else{if(0==gameBoard[x+1][y])return document.getElementById("s"+(x+1)+y).style.background="#4d88ff",document.getElementById("s"+(x+1)+y).classList.add("miss"),gameBoard[x+1][y]=3,shotsFired++,scanCounter++,void(document.getElementById("p"+(x+1)+y).innerText=shotsFired);if(1==gameBoard[x+1][y])return document.getElementById("s"+(x+1)+y).style.background="red",document.getElementById("s"+(x+1)+y).classList.add("hit"),gameBoard[x+1][y]=2,shotsFired++,shipFound++,shipDirection="ver",scanCounter=0,lastShotX++,void(document.getElementById("p"+(x+1)+y).innerText=shotsFired);scanCounter++}if(1==scanCounter&&""==shipDirection)if(x-1<0)scanCounter++;else{if(0==gameBoard[x-1][y])return document.getElementById("s"+(x-1)+y).style.background="#4d88ff",document.getElementById("s"+(x-1)+y).classList.add("miss"),gameBoard[x-1][y]=3,shotsFired++,scanCounter++,void(document.getElementById("p"+(x-1)+y).innerText=shotsFired);if(1==gameBoard[x-1][y])return document.getElementById("s"+(x-1)+y).style.background="red",document.getElementById("s"+(x-1)+y).classList.add("hit"),gameBoard[x-1][y]=2,shotsFired++,shipFound++,shipDirection="ver",scanCounter=0,lastShotX--,tempShipFound--,void(document.getElementById("p"+(x-1)+y).innerText=shotsFired);scanCounter++}if(2==scanCounter&&""==shipDirection)if(y+1>9)scanCounter++;else{if(0==gameBoard[x][y+1])return document.getElementById("s"+x+(y+1)).style.background="#4d88ff",document.getElementById("s"+x+(y+1)).classList.add("miss"),gameBoard[x][y+1]=3,shotsFired++,scanCounter++,void(document.getElementById("p"+x+(y+1)).innerText=shotsFired);if(1==gameBoard[x][y+1])return document.getElementById("s"+x+(y+1)).style.background="red",document.getElementById("s"+x+(y+1)).classList.add("hit"),gameBoard[x][y+1]=2,shotsFired++,shipFound++,shipDirection="hor",scanCounter=0,lastShotY++,void(document.getElementById("p"+x+(y+1)).innerText=shotsFired);scanCounter++}if(3==scanCounter&&""==shipDirection){if(0==gameBoard[x][y-1])return document.getElementById("s"+x+(y-1)).style.background="#4d88ff",document.getElementById("s"+x+(y-1)).classList.add("miss"),gameBoard[x][y-1]=3,shotsFired++,scanCounter++,void(document.getElementById("p"+x+(y-1)).innerText=shotsFired);if(1==gameBoard[x][y-1])return document.getElementById("s"+x+(y-1)).style.background="red",document.getElementById("s"+x+(y-1)).classList.add("hit"),gameBoard[x][y-1]=2,shotsFired++,shipFound++,shipDirection="hor",scanCounter=0,lastShotY--,tempShipFound--,void(document.getElementById("p"+x+(y-1)).innerText=shotsFired)}},searchingShot=function(){let x,y;if(shotsFired<8)do{shotsFired<4?(x=randomIntFromInterval(2,7),y=randomIntFromInterval(2,7)):(x=randomIntFromInterval(1,8),y=randomIntFromInterval(1,8))}while(x%2!=0&&y%2==0||x%2==0&&y%2!=0);else{const location=probabilityCalculator();[x,y]=location,resetProbabilityChart()}lastShotX=x,lastShotY=y,0==gameBoard[x][y]?(document.getElementById("s"+x+y).style.background="#4d88ff",document.getElementById("s"+x+y).classList.add("miss"),gameBoard[x][y]=3,shotsFired++,document.getElementById("p"+x+y).innerText=shotsFired):1==gameBoard[x][y]?(document.getElementById("s"+x+y).style.background="red",document.getElementById("s"+x+y).classList.add("hit"),gameBoard[x][y]=2,shotsFired++,shipFound++,document.getElementById("p"+x+y).innerText=shotsFired):2!=gameBoard[x][y]&&3!=gameBoard[x][y]&&4!=gameBoard[x][y]||searchingShot()},probabilityCalculator=function(){const lengthsLeft=[];let counter=0;carrierSunk||lengthsLeft.push(5),battleshipSunk||lengthsLeft.push(4),submarineSunk||lengthsLeft.push(3),cruiserSunk||lengthsLeft.push(3),destroyerSunk||lengthsLeft.push(2);for(let n=0;n<lengthsLeft.length;n++){for(let i=0;i<10;i++)for(let j=0;j<10-lengthsLeft[n]+1;j++){for(let k=0;k<lengthsLeft[n];k++)2!==gameBoard[i][j+k]&&3!==gameBoard[i][j+k]&&4!==gameBoard[i][j+k]&&counter++;if(counter===lengthsLeft[n])for(let k=0;k<lengthsLeft[n];k++)probabilityChart[i][j+k]++;counter=0}for(let i=0;i<10;i++)for(let j=0;j<10-lengthsLeft[n]+1;j++){for(let k=0;k<lengthsLeft[n];k++)2!==gameBoard[j+k][i]&&3!==gameBoard[j+k][i]&&4!==gameBoard[j+k][i]&&counter++;if(counter===lengthsLeft[n])for(let k=0;k<lengthsLeft[n];k++)probabilityChart[j+k][i]++;counter=0}}let currentMax=0,x,y;for(let i=0;i<10;i++)for(let j=0;j<10;j++)probabilityChart[i][j]>currentMax&&(currentMax=probabilityChart[i][j],x=i,y=j);return[x,y]},resetProbabilityChart=function(){for(let i=0;i<10;i++)for(let j=0;j<10;j++)probabilityChart[i][j]=0},compMove=function(){gameOver||(shipFound>0?shipFoundAttack():searchingShot(),shipSunkChecker(),gaveOverChecker())},shipHitButNotSunkReassign=function(){for(let i=0;i<10;i++)for(let j=0;j<10;j++)if("red"==document.getElementById("s"+i+j).style.background)return lastShotX=i,void(lastShotY=j)},sunkColorChange=function(shipName){for(let i=0;i<10;i++)for(let j=0;j<10;j++)document.getElementById("s"+i+j).classList.contains(shipName)&&document.getElementById("s"+i+j).classList.contains("hit")&&(document.getElementById("s"+i+j).style.background="darkred")};document.getElementById("compfr").addEventListener("click",(function(){for(let i=0;i<100&&!gameOver;i++)compMove()}))}();